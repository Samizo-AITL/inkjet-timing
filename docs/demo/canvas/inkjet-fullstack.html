<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Inkjet Full-stack Timing</title>
<style>
  body { margin:0; background:#111; color:#ccc; font-family:system-ui; }
  .wrap { max-width:1000px; margin:auto; padding:12px; }
  canvas { width:100%; height:560px; background:#000; display:block; }
  label { font-size:12px; }
</style>
</head>

<body>
<div class="wrap">
  <h2>Inkjet Full-stack Timing</h2>
  <p>V(t) → I(t) → Δx(t) → P(t) → Q(t)</p>
  <canvas id="c"></canvas>
</div>

<script type="module">
import { params } from "./params.js";
import { computeStack } from "./model.js";
import { drawStack } from "./draw.js";

const canvas = document.getElementById("c");

function resize(c){
  const dpr = window.devicePixelRatio || 1;
  const r = c.getBoundingClientRect();
  c.width = r.width * dpr;
  c.height = r.height * dpr;
  const ctx = c.getContext("2d");
  ctx.setTransform(dpr,0,0,dpr,0,0);
  return ctx;
}

let ctx = resize(canvas);
window.onresize = () => ctx = resize(canvas);

let stack = computeStack(params);
let cursor = 0;

function animate(){
  cursor += 0.35;
  if(cursor > params.T_us) cursor = 0;
  drawStack(ctx, stack, { cursor_us: cursor });
  requestAnimationFrame(animate);
}
animate();
</script>
</body>
</html>
